// WeakMap –∏ WeakSet

// WeakMap –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–±–æ—Ä –∏ –º–µ—Ç–æ–¥—ã keys(), values(), entries(),
// —Ç–∞–∫ —á—Ç–æ –Ω–µ—Ç —Å–ø–æ—Å–æ–±–∞ –≤–∑—è—Ç—å –≤—Å–µ –∫–ª—é—á–∏ –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –Ω–µ—ë.

// –í WeakMap –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:

//     weakMap.get(key)
//     weakMap.set(key, value)
//     weakMap.delete(key)
//     weakMap.has(key)

// WeakMap

// –ü–µ—Ä–≤–æ–µ –µ–≥–æ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Map –≤ —Ç–æ–º, —á—Ç–æ –∫–ª—é—á–∏ –≤ WeakMap
// –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–∞–º–∏, –∞ –Ω–µ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.
// E—Å–ª–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ä–µ–∫—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –∏ –µ—Å–ª–∏ –±–æ–ª—å—à–µ
// –Ω–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç, —Ç–æ –æ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∏–∑ –ø–∞–º—è—Ç–∏ (–∏ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ WeakMap) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

// –î—Ä—É–≥–∞—è —á–∞—Å—Ç–∞—è —Å—Ñ–µ—Ä–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è ‚Äì —ç—Ç–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ–≥–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω
// –≥–¥–µ-—Ç–æ –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å—Å—è (¬´–∫–µ—à–∏—Ä–æ–≤–∞—Ç—å—Å—è¬ª) –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –¥–∞–ª—å–Ω–µ–π—à–∏–µ –µ—ë –≤—ã–∑–æ–≤—ã –Ω–∞ —Ç–æ–º –∂–µ
// –æ–±—ä–µ–∫—Ç–µ –º–æ–≥–ª–∏ –ø—Ä–æ—Å—Ç–æ –±—Ä–∞—Ç—å —É–∂–µ –≥–æ—Ç–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—è –µ–≥–æ.

// –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Map, –≤–æ—Ç —Ç–∞–∫:

// üìÅ cache.js
let cache = new Map();

// –≤—ã—á–∏—Å–ª—è–µ–º –∏ –∑–∞–ø–æ–º–∏–Ω–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* —Ç—É—Ç –∫–∞–∫–∏–µ-—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

// –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º process() –≤ –¥—Ä—É–≥–æ–º —Ñ–∞–π–ª–µ:

// üìÅ main.js
let obj = {/* –¥–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –∫–∞–∫–æ–π-—Ç–æ –æ–±—ä–µ–∫—Ç */};

let result1 = process(obj); // –≤—ã—á–∏—Å–ª–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç

// ...–ø–æ–∑–∂–µ, –∏–∑ –¥—Ä—É–≥–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –∫–æ–¥–µ...
let result2 = process(obj); // —Ä–∞–Ω–µ–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∑—è—Ç –∏–∑ –∫–µ—à–∞

// ...–ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω:
obj = null;

alert(cache.size); // 1 (–£–ø—Å! –û–±—ä–µ–∫—Ç –≤—Å—ë –µ—â—ë –≤ –∫–µ—à–µ, –∑–∞–Ω–∏–º–∞–µ—Ç –ø–∞–º—è—Ç—å!)

// –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã process(obj) —Å —Ç–µ–º –∂–µ —Å–∞–º—ã–º –æ–±—ä–µ–∫—Ç–æ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –≤–µ–¥—É—Ç –∫ —Ç–æ–º—É,
// —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑, –∞ –∑–∞—Ç–µ–º –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã –±–µ—Ä—É—Ç –µ–≥–æ –∏–∑ –∫–µ—à–∞.
// –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–º —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—Ä—É—á–Ω—É—é –æ—á–∏—â–∞—Ç—å cache –æ—Ç —Å—Ç–∞–≤—à–∏—Ö –Ω–µ–Ω—É–∂–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤.

// –ù–æ –µ—Å–ª–∏ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WeakMap –≤–º–µ—Å—Ç–æ Map, —Ç–æ —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏—Å—á–µ–∑–Ω–µ—Ç: –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
// —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ –ø–∞–º—è—Ç–∏ —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞.

// üìÅ cache.js
let cache = new WeakMap();

// –≤—ã—á–∏—Å–ª—è–µ–º –∏ –∑–∞–ø–æ–º–∏–Ω–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* –≤—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

// üìÅ main.js
let obj = {/* –∫–∞–∫–æ–π-—Ç–æ –æ–±—ä–µ–∫—Ç */};

let result1 = process(obj);
let result2 = process(obj);

// ...–ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω:
obj = null;

// –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏—Ç—å cache.size, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ WeakMap,
// –Ω–æ –æ–Ω —Ä–∞–≤–µ–Ω 0 –∏–ª–∏ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —Ä–∞–≤–µ–Ω 0
// –ö–æ–≥–¥–∞ —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ —É–¥–∞–ª—è–µ—Ç obj, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞ —Ç–æ–∂–µ —É–¥–∞–ª—è—é—Ç—Å—è

// WeakSet

// –ö–æ–ª–ª–µ–∫—Ü–∏—è WeakSet –≤–µ–¥—ë—Ç —Å–µ–±—è –ø–æ—Ö–æ–∂–µ:

//      - –û–Ω–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞ Set, –Ω–æ –º—ã –º–æ–∂–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –≤ WeakSet —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã
//          (–Ω–µ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è).
//      - –û–±—ä–µ–∫—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Ç–æ–ª—å–∫–æ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –≥–¥–µ-—Ç–æ –µ—â—ë.
//      - –ö–∞–∫ –∏ Set, –æ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç add, has –∏ delete, –Ω–æ –Ω–µ size, keys() –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º–æ–π.

// –ë—É–¥—É—á–∏ ¬´—Å–ª–∞–±–æ–π¬ª –≤–µ—Ä—Å–∏–µ–π –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –æ–Ω–∞ —Ç–æ–∂–µ —Å–ª—É–∂–∏—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ
// –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ù–æ –Ω–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ —Å–∫–æ—Ä–µ–µ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π —Ç–∏–ø–∞ ¬´–¥–∞/–Ω–µ—Ç¬ª.
// –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –≤–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ WeakSet –º–æ–∂–µ—Ç —á—Ç–æ-—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞–º –æ–± –æ–±—ä–µ–∫—Ç–µ.

// –ù–∞–ø—Ä–∏–º–µ—Ä, –º—ã –º–æ–∂–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ WeakSet –¥–ª—è —É—á—ë—Ç–∞ —Ç–µ—Ö, –∫—Ç–æ –ø–æ—Å–µ—â–∞–ª –Ω–∞—à —Å–∞–π—Ç:

let visitedSet = new WeakSet();

let john = { name: "John" };
let pete = { name: "Pete" };
let mary = { name: "Mary" };

visitedSet.add(john); // John –∑–∞—Ö–æ–¥–∏–ª –∫ –Ω–∞–º
visitedSet.add(pete); // –ø–æ—Ç–æ–º Pete
visitedSet.add(john); // John —Å–Ω–æ–≤–∞

// visitedSet —Å–µ–π—á–∞—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

// –ø—Ä–æ–≤–µ—Ä–∏–º, –∑–∞—Ö–æ–¥–∏–ª –ª–∏ John?
alert(visitedSet.has(john)); // true

// –ø—Ä–æ–≤–µ—Ä–∏–º, –∑–∞—Ö–æ–¥–∏–ª–∞ –ª–∏ Mary?
alert(visitedSet.has(mary)); // false

john = null;
// —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö visitedSet –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

// –ù–∞–∏–±–æ–ª–µ–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º WeakMap –∏ WeakSet —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –∏—Ö –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–±—Ä–∞—Ç—å
// –∏–ª–∏ –≤–∑—è—Ç—å –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞, –Ω–æ –Ω–µ –º–µ—à–∞–µ—Ç WeakMap/WeakSet
// –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏—Ö –≥–ª–∞–≤–Ω—É—é –∑–∞–¥–∞—á—É ‚Äì –±—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤,
// —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –∏–∑ –∫–∞–∫–∏—Ö-—Ç–æ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç –≤ –∫–æ–¥–µ.

// –ò—Ç–æ–≥–æ

// WeakMap ‚Äì —ç—Ç–æ Map-–ø–æ–¥–æ–±–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–µ–π —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã,
// –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—â–∞—è –∏—Ö –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è
// –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–º–∏ –∏–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.

// WeakSet ‚Äì —ç—Ç–æ Set-–ø–æ–¥–æ–±–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã –∏ —É–¥–∞–ª—è–µ—Ç –∏—Ö, –∫–∞–∫ —Ç–æ–ª—å–∫–æ
// –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–º–∏ –∏–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.

// –û–±–µ —ç—Ç–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –º–µ—Ç–æ–¥—ã –∏ —Å–≤–æ–π—Å—Ç–≤–∞, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
// —Å—Ä–∞–∑—É –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–º–µ—Ä–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –í–æ–∑–º–æ–∂–Ω—ã —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º
// —ç–ª–µ–º–µ–Ω—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

// WeakMap –∏ WeakSet –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ ¬´–æ—Å–Ω–æ–≤–Ω–æ–º—É¬ª
// –º–µ—Å—Ç—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞. –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è,
// –∫—Ä–æ–º–µ –∫–∞–∫ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –≤ WeakMap –∏–ª–∏ –≤ WeakSet, —Ç–æ –æ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.